<!DOCTYPE html>
<html style="background-color: #eee">
<head>
  <title>futures</title>
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/bulma@0.7.4/css/bulma.css">
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.css">
  <style type="text/css">
    .typed {
      font-family: "Roboto", monospace;
    }
  </style>
  <script>
    function handleLoaded() {
      registerProtocol();
      autoNavigate();
    }

    function registerProtocol() {
      try {
        navigator.registerProtocolHandler(
          "dat",
          location.href + "?url=%s",
          "Dat Gateway Redirection"
        )
      } catch(e) {
        console.error("Couldn't register protocol handler");
        console.error(e);
      }
    }

    function autoNavigate() {
       // Attempt to load the Dat URL from the querystring
      var parsedURL = new URL(window.location.href)
      var toNavigate = parsedURL.searchParams.get("url")
      if (toNavigate) {
        document.querySelector("input").value = toNavigate;
      }
    }

    function navigateUrl(url) {
      if(!url){
        url = document.querySelector("input").value;
      }

      var cleaned = url.replace(/^dat:\/\//, "");
      window.location.href = "/" + cleaned;
      return false;
    }
  </script>
</head>
<body onload="return handleLoaded()">
  <section class="section" style="padding: 10rem 10rem;">
    <div class="" style="max-width:480px">
      <h1 class="title typed">portal directory</h1>

      <p class="subtitle typed">shortcuts</p>
      <ul>
        <li class="typed">>&nbsp;&nbsp;<a onclick="return navigateUrl('dat://d0376bf19864c8cf3d25b3ecfe66d2b4d1d3fc675e57489a84eecc5cb4b3dc5d')">futures shoppe </a></li>
        <li class="typed">>&nbsp;&nbsp;<i>your_shop_here</i></li>
      </ul>
      <div class="content">
        <p>
          <form onsubmit="return navigateUrl()" style="padding-top: 50px;">
            <div class="field has-addons">
              <div class="control is-expanded">
                <input class="input" placeholder="search dat://">            
              </div>
              <br />
              <br />
              <br />
              <div class="control">
                <button class="button is-info typed" style="background: #222;">explore</button>
              </div>
            </div>
          </form>
        </p>
        <canvas id='canvas'></canvas>
      </div>
    </div>
  </section>
</body>
</html>